input {
  file {
    type => "syslog"
    path => ["/var/log/auth.log", "/var/log/messages"]
    exclude => ["*.gz", "shipper.log"]
    #debug => true
  }

  file {
    type => "apache"
    path => ["/var/log/apache2/logstash_access_log"]
    format => "json_event"
  }

  file {
    type => "postfix"
    path => ["/var/log/mail.*"]
  }

  file {
    type => "tomcat"
    path => ["/var/log/tomcat6/catalina.out"]
  }


}

filter {

   grok {
       type => "postfix"
       patterns_dir => ["/etc/logstash/patterns"]
       pattern => ["%{POSTFIX}"]
       add_tag => [ "postfix", "grokked", "%{component}" ]
   }
   
   grok {
        tags => "qmgr"
        patterns_dir => ["/etc/logstash/patterns"]
        pattern => "%{POSTFIXQMGR}"
    }

    grok {
      type => "tomcat"
      tags => "multiline"
      pattern => "%{JAVASTACKTRACEPART}"
    }

    date {
      type => "postfix"
      match => [ "timestamp", "MMM dd HH:mm:ss" ]
      add_tag => [ "dated" ]
    }

    grep {
      type => "tomcat"
      match => [ "@message", "(.+)" ]
      #drop => true
      add_tag => [ "grepped" ]
    }

    grep {
      type => "tomcat"
      drop => false
      add_tag => "%{@source_host}"    
    }
    
    multiline {
      type => "tomcat"
      pattern => "(^\d+\serror)|(^.+Exception: .+)|(^\s+at .+)|(^\s+... \d+ more)|(^\s*Caused by:.+)"
      what => "previous"
    }

}


output {
  stdout {
    debug => true
  }
  redis {
    host => "10.0.0.2"
    data_type => "list"
    key => "logstash"
  }
}